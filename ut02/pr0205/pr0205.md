# PR0205: Programación de tareas con `cron`

## Aspectos generales

### Objetivos de la práctica

En esta práctica vamos a explorar las diferentes posibilidades de `cron` para crear tareas programadas en un entorno Linux.


## Enunciado

Contesta a las siguientes preguntas:

1. ¿Qué orden pondrías en crontab en los siguientes casos?

 - La tarea se ejecuta cada hora 
```bash
0 * * * * comando
```
  - La tarea se ejecuta los domingos cada 3 horas 
```bash
0 */3 * * 0 comando
```
   - La tarea se ejecuta a las 12 de la mañana los días pares del mes.

```bash
  0 12 */2 * * comando
```
- La tarea se ejecuta el primer día de cada mes a las 8 de la mañana y a las 8 de la tarde.
```bash
  0 8,20 1 * * comando
```
- La tarea se ejecuta cada media hora de lunes a viernes.
```bash
0,30 * * * 1-5 comando
```
- La tarea se ejecuta cada cuarto de hora, entre las 3 y las 8, de lunes a viernes, durante todo el mes de agosto
```bash  
*/15 3-8 * 8 1-5 comando
```
- La tarea se ejecuta cada 90 minutos
```bash
    30 */3 * * * comando
```

2. ¿Cómo compruebas si el servicio cron se está ejecutando?

```bash
    systemctl status cron
```
3. ¿Cuál es el efecto de la siguiente línea `crontab`?

```bash
    */15 1,2,3 * * * who > /tmp/test
```

1. Indica la ruta del fichero `crontab` del sistema

```bash
    /etc/crontab
```

2. ¿Qué ficheros controlan los usuarios que pueden utilizar el `crontab`?

```bash
   /etc/cron.allow y /etc/cron.deny
```

3. Excepcionalmente se debe iniciar una tarea llamada `script.sh` todos los lunes a las 07:30h antes de entrar en clase ¿Cómo lo harías?

```bash
    crontab -e
    30 7 * * 1 script.sh

```

4. Se ha cancelado la tarea. ¿Cómo listar y luego, suprimir la tarea?

```bash
    crontab -l
    crontab -r
```

5.  Ejecuta el comando `ps -ef` para el usuario `root` cada 2 minutos y redirecciona el resultado a `/tmp/ps_result` sin sobrescribir los antiguos.
```bash
    sudo crontab -e
    */2 * * * * ps -ef >> /tmp/ps_result
```
6. Verifica la lista de tareas en `crontab`
```bash
   laura@laura:~$ crontab -l
# Edit this file to introduce tasks to be run by cron.
#
# Each task to run has to be defined through a single line
# indicating with different fields when the task will be run
# and what command to run for the task
#
# To define the time you can provide concrete values for
# minute (m), hour (h), day of month (dom), month (mon),
# and day of week (dow) or use '*' in these fields (for 'any').
#
# Notice that tasks will be started based on the cron's system
# daemon's notion of time and timezones.
#
# Output of the crontab jobs (including errors) is sent through
# email to the user the crontab file belongs to (unless redirected).
#
# For example, you can run a backup of all your user accounts
# at 5 a.m every week with:
# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
#
# For more information see the manual pages of crontab(5) and cron(8)
#
# m h  dom mon dow   command
*/2 * * * * root ps -ef > /tmp/ps_results
```
7.  Espera unos minutos y comprueba el resultado en `/tmp`
```bash
    laura@laura:~$ cat /tmp/ps_result
```
8.  Crea el usuario `asir2` y prohíbele utilizar el `crontab`.
```bash
    laura@laura:~$ sudo adduser asir2
    laura@laura:~$ sudo nano cron.deny
```
9.  Verifica que el usuario `asir2` realmente no puede utilizar `crontab`
```bash
    asir2@laurar:~$ crontab -e
You (asir2) are not allowed to use this program (crontab)
See crontab(1) for more information
```
10.  Programa `crontab` para que cada día a las 0:05 se eliminen todos los ficheros que se encuentran en el directorio `/tmp`. 
```bash
    5 0  * * *  rm -rf /tmp/*
```
11.  Programa una tarea en el sistema que se lance de lunes a viernes a las 9 de la mañana durante los meses de verano (julio, agosto y septiembre) que escriba en un fichero la hora actual (comando `date`, aunque tienes que mirar la ayuda para elegir un formato comprensible) seguido del listado de usuarios que hay conectados en ese momento en el sistema (comando `who`)
```bash
    0 9 * 7-9 1-5 (date "+%d-%m-%Y %H:%M:%S"; who) > file
```
12.  El servicio `cron` se ayuda de una serie de ficheros y directorios que se encuentran en el directorio `/etc`. Explica la función de cada uno de los siguientes ficheros/directorios:
     - `cron.d`:

Contiene archivos de configuración adicionales.Se usa para tareas especificas de paquetes del sistema o servicios.

```bash
cron.allow:
```
Lista de usuarios autorizados a usar crontab.

     - `cron.deny`:
  
Lista de usuarios prohibidos de usar crontab.

    - `cron.daily`:

Contiene scripts que se ejecutan una vez al dia.

    - `cron.hourly`:

Contiene scripts que se ejecutan una vez cada hora.

    - `cron.monthly`:

Contiene scripts que se ejecutan una vez al mes.